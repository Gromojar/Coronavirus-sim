<!DOCTYPE html>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<style>
 
input
{
	text-align: center;
}

</style>

<html>
<body>
	<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>App Analyser</title>
<center>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="index.html">Quality Tools</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="index.html">Menu <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="QualityImageUrlRenderer.html">Image url renderer</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Websiteanalyzer.html">Website analyser</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="UrlOpener.html">Url opener</a>
      </li>
	          <li class="nav-item">
            <a class="nav-link" href="PasswordGenerator.html">Password Generator</a>
          </li> 
              <li class="nav-item">
            <a class="nav-link" href="WebsiteRenderer.html">Website Renderer</a>
          </li>
	                  <li class="nav-item">
            <a class="nav-link" href="Merger.html">Text Merger</a>
          </li>
	    	                  <li class="nav-item">
            <a class="nav-link" href="Base64Decoder.html">Base64 Decoder</a>
          </li>
      	    	                  <li class="nav-item">
            <a class="nav-link" href="UrlDecoder.html">UrlDecoder</a>
          </li>
	          	    	                  <li class="nav-item">
            <a class="nav-link" href="Analyser.html">App Analyser</a>
          </li>
    </ul>
  </div>
</nav>
<div class="container">
<div class="card text-black bg-light mb-3">
  <div class="card-header">App analyser</div>
<br><br>
<div class="inline-div">
    <p align="center">Naked iOS ID like '417926051'</p>
    <textarea id="tocheck" cols="30" rows="15" class="inline-txtarea"></textarea>
</div>
<br><br>
<label for="AvgRating">Min. average rating: </label>
<input id="AvgRating" type="number" name="AvgRating" value="3" step="0.1" max="5" min="0">
<label for="MinReviews">Min. review count: </label>
<input id="MinReviews" type="number" name="MinReviews" value="50" step="1" min="0">
<label for=utility">Reject utility category </label>
	<center><input id="utility" type="checkbox"></center>
<button class="btn btn-secondary" id="indicator" onclick="Skanuj()">Scan</button><br>
	<div class="result" id="buttonsection">
    

  </div><hr><hr>
	<center><img id="image" width="100"/></center>
<div class="result" id="result"></div><hr id=approvedscroll>
	<p><b>Approved: </b></p><div class="result" id="approved"></div><br><hr id="id=notapprovedscroll">
	<p><b>Not approved: </b></p><div class="result" id="notapproved"></div><br><hr id="id=notfoundscroll">
	<p><b>Not found: </b></p><div class="result" id="notfound"></div><br><hr>
  
</div>
	</div>
	</center>
	<script>
var mydata;
var mydata2;
var adt;
var Apps;
var Apps_split;
var Apps_checked = [];
var i=0;
var j=0;
var a=0;
var data;
var rating =0;
var numberofratings=0;
var checked = 1;
var minrating;
var minreviews;
var utilities;
var file;
function Skanuj()
{
	document.getElementById("notapproved").innerHTML = "";
	document.getElementById("approved").innerHTML = "";
	document.getElementById("notfound").innerHTML = "";
	document.getElementById("result").innerHTML = "";
  document.getElementById("indicator").innerHTML = "<p>Processing...</p>";

	document.getElementById("indicator").disabled = true;
minrating = document.getElementById("AvgRating").value;
minreviews = document.getElementById("MinReviews").value;
if(document.getElementById("utility").checked == true)
	{
utilities = 1;
	}
	else
	{
utilities = 0;
	}
rating = 0;
numberofratings = 0;
Apps = document.getElementById("tocheck").value;
Apps_split = Apps.split(/\n|,/g);

for (i=0; i < Apps_split.length; i++)
{

    
        var text = "https://itunes.apple.com/lookup?id=" + Apps_split[i] + "&callback=?";
        
    $.getJSON(text, function (data) {

 if(data.resultCount == 0)
 {
     console.log(Apps_split[i]);
 }
else
  {
    console.log(data);
    console.log(data.results[0].trackId);
	  let app_name = data.results[0].trackId;
	Apps_checked.push("" + app_name + "");

      document.getElementById("result").innerHTML += "<center><img src='" + data.results[0].artworkUrl100 + "' width='100'></center>";
      document.getElementById("result").innerHTML += data.results[0].trackCensoredName + "<br>";
document.getElementById("result").innerHTML += "BundleId:" + data.results[0].trackId + "<br>";
				if(data.results[0].sellerUrl != null)
				{
document.getElementById("result").innerHTML += "Developer page: <a href='" + data.results[0].sellerUrl + "'>" + data.results[0].sellerUrl + "</a><br>";
				}
				else
				{
document.getElementById("result").innerHTML += "Developer page: not found<br>";				
				}
if(data.results[0].averageUserRating < minrating)
{
    document.getElementById("result").innerHTML += "<b style='color:red'>Rating: " + data.results[0].averageUserRating + "<br></b>";
	rating=0;
}
if(data.results[0].averageUserRating >= minrating)
{
    document.getElementById("result").innerHTML += "<b style='color:green'>Rating: " + data.results[0].averageUserRating + "<br></b>";
	rating=1;
}
if(data.results[0].userRatingCount < minreviews)
{
    document.getElementById("result").innerHTML += "<b style='color:red'>Number of user ratings: " + data.results[0].userRatingCount + "<br></b>";
	numberofratings=0;
}
if(data.results[0].userRatingCount >= minreviews)
{
    document.getElementById("result").innerHTML += "<b style='color:green'>Number of user ratings: " + data.results[0].userRatingCount + "<br></b>";
	numberofratings=1;
}


if(data.results[0].primaryGenreName == "Utilities")
{
document.getElementById("result").innerHTML += "<b style='color:orange'>Primary Category: " + data.results[0].primaryGenreName + "<br><hr>";
}
else
{
document.getElementById("result").innerHTML += "Primary Category: " + data.results[0].primaryGenreName + "<br><hr>";
}
  if(utilities == 1)
{	
    if(rating == 1 && numberofratings == 1)
    {
        if(data.results[0].primaryGenreName == "Utilities")
          {
            document.getElementById("notapproved").innerHTML += data.results[0].trackId + "<br>";
          }
          else
          {
            document.getElementById("approved").innerHTML += data.results[0].trackId + "<br>";
          }
      
    }
else
{
	document.getElementById("notapproved").innerHTML += data.results[0].trackId + "<br>";
}

	 
}
if(utilities == 0)
{	
    if(rating == 1 && numberofratings == 1)
    {
       
            document.getElementById("approved").innerHTML += data.results[0].trackId + "<br>";
          
      
    }
else
{
	document.getElementById("notapproved").innerHTML += data.results[0].trackId + "<br>";
}

	 
}

    

        


    

  }
        

})
.done(function() { setchecked(); })
;
       
    
    
}

$(document).ajaxStop(function () {
  document.getElementById("indicator").innerText = "Done! Scan again?";
  document.getElementById("buttonsection").innerHTML = "<a class='btn btn-secondary' href='#approvedscroll'>Approved</a><a class='btn btn-secondary' href='#notapprovedscroll'>Not approved</a><a class='btn btn-secondary' href='#notfoundscroll'>Not found</a><br><button class='btn btn-secondary' id='result' onclick='download_csv()'>Download CSV</button>";
        check();
	document.getElementById("indicator").disabled = false;
        });
}



//console.log(mydata.results[0].averageUserRating);


//"Rating: " + data.results[0].averageUserRating;
function setchecked()
{
  checked = 1;
}
function isInArray(value, array) {
  return array.indexOf(value) > -1;
}			
		
		function check()
		{
			let element;
			for (element in Apps_split)
{
	  if(Apps_checked.includes(Apps_split[element]) == true)
{
	console.log(Apps_split[element] + "is present");
}
	    else
	    {
		    console.log("App " + Apps_split[element] + " not found!");
		document.getElementById("notfound").innerHTML += Apps_split[element] + "<br>";
	    }
}
			
		}

    function download_csv() {
      let temp = document.getElementById("approved").innerText;
      let temp2 = document.getElementById("notapproved").innerText;
      let temp3 = document.getElementById("notfound").innerText;
      temp = temp.split((/\n|,/g));
      temp2 = temp2.split((/\n|,/g));
      temp3 = temp3.split((/\n|,/g));
      temp.splice(-1,1);
      temp2.splice(-1,1);
      temp3.splice(-1,1);
      file = temp;
      file2 = temp2;
      file3 = temp3;
    var csv = 'Domain, Result';
    for(let element in file)
    {
      csv += "\n";
           csv += file[element] + ",Approved";
    }
    for(let element in file2)
    {
      csv += "\n";
           csv += file2[element] + ",Not Approved";
    }
    for(let element in file3)
    {
      csv += "\n";
           csv += file3[element] + ",Not Found";
    }
 
    console.log(csv);
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'Export.csv';
    hiddenElement.click();
}
</script>
</body>
</html>
